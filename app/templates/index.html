{% extends 'layout.html' %}

{% block content %}

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="">Chat App</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#">Hello {{ current_user.username | title }}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('logout') }}">
                        Logout
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row mt-5">
        <div class="col-lg-6">
            <ul id="messages">
                {% for chat in chats %}
                <li>{{ chat.message }}</li>
                {% endfor %}
            </ul>
            <input type="text" id="msgInput" class="form-control">
            <button class="btn btn-sm btn-primary" id="sendMsg">Send</button>
        </div>
        <div class="col-lg-6"></div>
    </div>
</div>

{% endblock %}


{% block script %}
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
    integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf-8">
    $(document).ready(() => {
        var socket = io();
        socket.on('connect', () => {
            socket.send('User Connected!');
        });
        socket.on('message', (data) => {
            $('#messages').append(`<li>${data}</li>`)
        });

        $('#sendMsg').click(() => {
            let msgEl = $('#msgInput');
            socket.send(msgEl.val());
            msgEl.val('');
        })
    })
</script>

{% endblock script %}